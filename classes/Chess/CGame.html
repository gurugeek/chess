<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Class: Chess::CGame</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
    <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'>
    <tr>
  <td class="file-title"><span class="file-title-prefix">Class</span><br />Chess::CGame</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../files/ext/chess_c.html">ext/chess.c</a>:
        </td>
      </tr>
      <tr>
        <td>Parent:</td>
        <td>

      Object         </td>
     </tr>
         </table>
        </td>
        </tr>
      </table>
  <div id="bodyContent">
  <div id="content">

  <div class="description">
<p>This class rappresents a collection of boards of a single chess game.</p>
</div>


  <div class="sectiontitle">Methods</div>
  <ul>
                <li><a href="#method-i-5B-5D">[]</a></li>
                <li><a href="#method-i-board">board</a></li>
                <li><a href="#method-i-each">each</a></li>
                <li><a href="#method-i-full_moves">full_moves</a></li>
                <li><a href="#method-i-move">move</a></li>
                <li><a href="#method-i-move2">move2</a></li>
                <li><a href="#method-i-move3">move3</a></li>
                <li><a href="#method-i-moves">moves</a></li>
                <li><a href="#method-i-result">result</a></li>
                <li><a href="#method-i-rollback-21">rollback!</a></li>
                <li><a href="#method-i-set_fen-21">set_fen!</a></li>
                <li><a href="#method-i-size">size</a></li>
                <li><a href="#method-i-threefold_repetition-3F">threefold_repetition?</a></li>
      </ul>




                        
    <div class="sectiontitle">
      Public      Instance      methods
    </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-5B-5D"></a>
            <b>[n]</b>
          
        </div>

                  <div class="description">
            <p>Returns the <code>n</code>-th <a href="Board.html">Board</a> of the <a
href="Game.html">Game</a> or <code>nil</code> if the <code>n</code>-th <a
href="Board.html">Board</a> does not exist.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('5B-5D_source')"
                 id="l_method-i-5B-5D_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="5B-5D_source">
<pre>
  VALUE
game_boards (VALUE self, VALUE index)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  int n = FIX2INT (index);
  Board *board = get_board (g, n);
  if (board)
    return Data_Wrap_Struct (board_klass, 0, 0, board);
  return Qnil;
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-board"></a>
            <b>current</b>
          
        </div>

                  <div class="description">
            <p>Returns the current <a href="Board.html">Board</a> of the <a
href="Game.html">Game</a>.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('board_source')"
                 id="l_method-i-board_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="board_source">
<pre>
  VALUE
game_last_board (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  return game_boards (self, INT2FIX (g-&gt;current-1));
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-each"></a>
            <b>each { |board, move, full_move, index| block }</b>
          
        </div>

                  <div class="description">
            <p>Calls <code>block</code> once for each <code>board</code> in self, passing
that <code>board</code>, <code>move</code>, <code>full_move</code> and
<code>index</code> as parameters. Return self. If no block is given, the
array of game moves is returned instead.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('each_source')"
                 id="l_method-i-each_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="each_source">
<pre>
  VALUE
game_each (VALUE self)
{
  if (!rb_block_given_p ())
    return game_moves(self);
  int i;
  Game *g;
  Data_Get_Struct (self, Game, g);
  for (i = 0; i &lt; g-&gt;current; i++)
    rb_yield_values (4, Data_Wrap_Struct (board_klass, 0, 0, get_board (g, i)),
                     rb_str_new2 (g-&gt;moves[i]), rb_str_new2 (g-&gt;full_moves[i]),
                     INT2FIX (i));
  return self;
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-full_moves"></a>
            <b>full_moves</b>
          
        </div>

                  <div class="description">
            <p>Returns the array with all full moves done <em>(es: b1c3)</em>.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('full_moves_source')"
                 id="l_method-i-full_moves_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="full_moves_source">
<pre>
  VALUE
game_full_moves (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  int i;
  VALUE moves = rb_ary_new ();
  for (i = 0; i &lt; g-&gt;current; i++)
    rb_ary_push (moves, rb_str_new2 (g-&gt;full_moves[i]));
  return moves;
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-move"></a>
            <b>move(piece, disambiguating, to_coord, promote_in)</b>
          
        </div>

                  <div class="description">
            <p>Make a move. This add a new <a href="Board.html">Board</a> in the <a
href="Game.html">Game</a>.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>piece</code>
<dd>
<p>the character of the moving piece <em>(‘P’, ‘R’, ‘N’, ‘B’, ‘Q’, ‘K’)</em>.</p>
</dd><dt><code>disambiguating</code>
<dd>
<p>when two (or more) identical pieces can move to the same square, the moving
piece is uniquely identified by specifying the piece’s letter, followed by
(in descending order of preference):</p>
<ol><li>
<p>the file of departure (if they differ); or</p>
</li><li>
<p>the rank of departure (if the files are the same but the ranks differ); or</p>
</li><li>
<p>both the rank and file (if neither alone is sufficient to identify the
piece—which occurs only in rare cases where one or more pawns have
promoted, resulting in a player having three or more identical pieces able
to reach the same square).</p>
</li></ol>

<p>Keep blank if no needed.</p>
</dd><dt><code>to_coord</code>
<dd>
<p>the square where the moving piece will <em>(‘a1’, ‘a2’, … , ‘h7’,
‘h8’)</em>.</p>
</dd><dt><code>promote_in</code>
<dd>
<p>the character of promotion piece <em>(‘R’, ‘N’, ‘B’, ‘Q’)</em>. If no
promotion occured, this param will be ignored.</p>
</dd></dl>

<p>This method returns a string that represents the short algebraic chess
notation of the move or raise an <a
href="IllegalMoveError.html">IllegalMoveError</a> if the move is illegal.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('move_source')"
                 id="l_method-i-move_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="move_source">
<pre>
  VALUE
game_move (VALUE self, VALUE rb_piece, VALUE rb_disambiguating, VALUE rb_to_coord, VALUE rb_promote_in)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  Board *board = current_board (g);
  char piece = StringValuePtr (rb_piece)[0];
  char *disambiguating = StringValuePtr (rb_disambiguating);
  char *to_coord = StringValuePtr (rb_to_coord);
  char promote_in = StringValuePtr (rb_promote_in)[0];
  int from, to;
  get_coord (board, piece, disambiguating, to_coord, promote_in, &amp;from, &amp;to);
  // printf (&quot;From: %d, To: %d, Promo: %c\n&quot;, from , to , promote_in);
  if (pseudo_legal_move (board, from, to) &amp;&amp; apply_move (g, from, to, promote_in))
    return rb_str_new2 (current_move (g));
  else
    rb_raise (illegal_move_error, &quot;Illegal move&quot;);
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-move2"></a>
            <b>move2(from, to, promote_in)</b>
          
        </div>

                  <div class="description">
            <p>Make a move. This add a new <a href="Board.html">Board</a> in the <a
href="Game.html">Game</a>.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>from</code>
<dd>
<p>The 2 character string representing the starting square of the moving piece
<em>(‘a1’, ‘a2’, … , ‘h7’, ‘h8’)</em>.</p>
</dd><dt><code>to</code>
<dd>
<p>The 2 character string representing the ending square of the moving piece
<em>(‘a1’, ‘a2’, … , ‘h7’, ‘h8’)</em>.</p>
</dd><dt><code>promote_in</code>
<dd>
<p>the character of promotion piece <em>(‘R’, ‘N’, ‘B’, ‘Q’)</em>. If no
promotion occured, this param will be ignored.</p>
</dd></dl>

<p>This method returns a string that represents the short algebraic chess
notation of the move or raise an <a
href="IllegalMoveError.html">IllegalMoveError</a> if the move is illegal.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('move2_source')"
                 id="l_method-i-move2_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="move2_source">
<pre>
  VALUE
game_move2 (VALUE self, VALUE rb_from, VALUE rb_to, VALUE rb_promote_in)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  Board *board = current_board (g);
  int from = coord_to_square (StringValuePtr (rb_from));
  int to = coord_to_square (StringValuePtr (rb_to));
  char promote_in = StringValuePtr (rb_promote_in)[0];
  if (pseudo_legal_move (board, from, to) &amp;&amp; apply_move (g, from, to, promote_in))
    return rb_str_new2 (current_move (g));
  else
    rb_raise (illegal_move_error, &quot;Illegal move&quot;);
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-move3"></a>
            <b>move3(from, to, promote_in)</b>
          
        </div>

                  <div class="description">
            <p>Make a move. This add a new <a href="Board.html">Board</a> in the <a
href="Game.html">Game</a>.</p>

<p>Each square on the chessboard is represented by an integer according to the
following scheme:</p>

<pre>8 | 56 57 58 59 60 61 62 63
7 | 48 49 50 51 52 53 54 55
6 | 40 41 42 43 44 45 46 47
5 | 32 33 34 35 36 37 38 39
4 | 24 25 26 27 28 29 30 31
3 | 16 17 18 19 20 21 22 23
2 |  8  9 10 11 12 13 14 15
1 |  0  1  2  3  4  5  6  7
  +-------------------------
     a  b  c  d  e  f  g  h</pre>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>from</code>
<dd>
<p>The integer representing the starting square of the moving piece.</p>
</dd><dt><code>to</code>
<dd>
<p>The integer representing the ending square of the moving piece.</p>
</dd><dt><code>promote_in</code>
<dd>
<p>the character of promotion piece <em>(‘R’, ‘N’, ‘B’, ‘Q’)</em>. If no
promotion occured, this param will be ignored.</p>
</dd></dl>

<p>This method returns a string that represents the short algebraic chess
notation of the move or raise an <a
href="IllegalMoveError.html">IllegalMoveError</a> if the move is illegal.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('move3_source')"
                 id="l_method-i-move3_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="move3_source">
<pre>
  VALUE
game_move3 (VALUE self, VALUE rb_from, VALUE rb_to, VALUE rb_promote_in)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  Board *board = current_board (g);
  int from = FIX2INT (rb_from);
  int to = FIX2INT (rb_to);
  char promote_in = StringValuePtr (rb_promote_in)[0];
  if (pseudo_legal_move (board, from, to) &amp;&amp; apply_move (g, from, to, promote_in))
    return rb_str_new2 (current_move (g));
  else
    rb_raise (illegal_move_error, &quot;Illegal move&quot;);
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-moves"></a>
            <b>moves</b>
          
        </div>

                  <div class="description">
            <p>Returns the array with all moves done <em>(es: Nc3)</em>.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('moves_source')"
                 id="l_method-i-moves_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="moves_source">
<pre>
  VALUE
game_moves (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  int i;
  VALUE moves = rb_ary_new ();
  for (i = 0; i &lt; g-&gt;current; i++)
    rb_ary_push (moves, rb_str_new2 (g-&gt;moves[i]));
  return moves;
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-result"></a>
            <b>result</b>
          
        </div>

                  <div class="description">
            <p>Returns the result of the game:</p>
<dl class="rdoc-list note-list"><dt>*
<dd>
<p>game in progress;</p>
</dd><dt>1-0
<dd>
<p>white won;</p>
</dd><dt>0-1
<dd>
<p>black won;</p>
</dd><dt>1/2-1/2
<dd>
<p>draw</p>
</dd></dl>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('result_source')"
                 id="l_method-i-result_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="result_source">
<pre>
  VALUE
game_result (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  char *result = result_to_s (g-&gt;result);
  VALUE rb_result = rb_str_new2 (result);
  free (result);
  return rb_result;
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-rollback-21"></a>
            <b>rollback!</b>
          
        </div>

                  <div class="description">
            <p>Rollback last move.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('rollback-21_source')"
                 id="l_method-i-rollback-21_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="rollback-21_source">
<pre>
  VALUE
game_rollback (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  rollback (g);
  return self;
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-set_fen-21"></a>
            <b>set_fen!(fen)</b>
          
        </div>

                  <div class="description">
            <p>Set the game position with a FEN string.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>fen</code>
<dd>
<p>the FEN (Forsyth–Edwards Notation) string notation used to set the game
position.</p>
</dd></dl>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('set_fen-21_source')"
                 id="l_method-i-set_fen-21_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="set_fen-21_source">
<pre>
  VALUE
game_set_fen (VALUE self, VALUE fen)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  set_fen (g, StringValuePtr (fen));
  return self;
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-size"></a>
            <b>size</b>
          
        </div>

                  <div class="description">
            <p>Returns the number of moves done.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('size_source')"
                 id="l_method-i-size_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="size_source">
<pre>
  VALUE
game_size (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  return INT2FIX (g-&gt;current);
}</pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-threefold_repetition-3F"></a>
            <b>threefold_repetition?</b>
          
        </div>

                  <div class="description">
            <p>Returns <code>true</code> if a player can claim draw by the threefold
repetition rule, <code>false</code> otherwise.</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('threefold_repetition-3F_source')"
                 id="l_method-i-threefold_repetition-3F_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="threefold_repetition-3F_source">
<pre>
  VALUE
game_threefold_repetition (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  if (threefold_repetition (g))
    return Qtrue;
  else
    return Qfalse;
}</pre>
            </div>
          </div>
        
      </div>

              </div>
  </div>
  </body>
</html>
